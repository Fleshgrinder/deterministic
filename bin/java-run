#!/usr/bin/env bash
set -Eeuo pipefail
shopt -s globstar

format=${1:?missing required <format> argument}
version=${2:?missing required <version> argument}
dir="build/$format/$version"

classpath="$dir/target/java"
for jar in build/"$format"/*.jar "$dir"/*.jar; do
  classpath="$classpath:$jar"
done

printf '\e[1m> ran \e[37m%s %s java\e[0m\n' "$format" "$version" >&2
printf '\e[31m' >&2
./build/jdk/bin/java \
  -Djdk.module.illegalAccess.silent=true \
  -classpath "$classpath" \
  "${format^}Main" >"$dir/java.bin"
printf '\e[0m' >&2
